# åˆ›å»ºæ–°çš„æ’ä»¶

ä¸ºäº†ç®€å„¿åŸç”ŸåŠŸèƒ½çš„ä¸°å¯Œæ€§ï¼Œæå‡å¼€å‘è€…äºŒæ¬¡å¼€å‘çš„ä¾¿æ·æ€§ï¼Œç®€å„¿äº 2025.02 æ¨å‡ºäº†å…¨æ–°çš„ **NEXT PREVIEW åˆ†æ”¯**ã€‚æ­¤åˆ†æ”¯çš„åŸç”ŸåŠŸèƒ½å®é™…æ˜¯ 2.0 ç‰ˆæœ¬çš„è¿­ä»£ï¼Œä½†æœ¬åˆ†æ”¯æ–°å¢äº†æ’ä»¶å…¼å®¹æ€§ï¼Œä¸ºå¹¿å¤§å¼€å‘è€…ä»¬æä¾›äº†æ›´å‹å¥½çš„æ’ä»¶å¼€å‘å…¥å£ã€‚

::: warning ç¨³å®šæ€§æç¤º
NEXT PREVIEW åˆ†æ”¯æ˜¯**é¢„è§ˆåˆ†æ”¯**ï¼Œæ’ä»¶å…¼å®¹æ€§æœ‰å¾…è¯„ä¼°ï¼ŒæŠ•å…¥å®é™…ä½¿ç”¨å¯èƒ½ä¸ä¼šå…·æœ‰é¢„æœŸä¸­çš„ç¨³å®šæ€§ã€‚è¯·è°¨æ…ä½¿ç”¨æœ¬åˆ†æ”¯äº§å“ï¼Œå¦‚æœ‰é‡åˆ° Bugï¼Œè¯·ç«‹å³åé¦ˆäº [Issue](https://github.com/SRInternet-Studio/Jianer_QQ_bot/issues/new)ï¼Œæ„Ÿè°¢æ‚¨çš„è°…è§£ä¸æ”¯æŒã€‚
:::

## 0. åŸç†è®²è§£ï¼ˆå¿…çœ‹ï¼‰ {#principle}

ä½ å¯ä»¥åœ¨ç®€å„¿çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ° `plugins` æ–‡ä»¶å¤¹ï¼Œè¿™æ˜¯æ’ä»¶çš„å­˜æ”¾ç›®å½•ã€‚

æ’ä»¶å¯ä»¥ä»¥ä»¥ä¸‹å½¢å¼åœ¨ `plugins` æ–‡ä»¶å¤¹ä¸­å­˜åœ¨ï¼š

| å½¢å¼ | è¯´æ˜ |
| --- | --- |
| `.py` æ–‡ä»¶ | å•ä¸ªæ–‡ä»¶å½¢å¼çš„æ’ä»¶ï¼Œç›´æ¥æ”¾åœ¨ `plugins` ç›®å½•ä¸‹ |
| `.pyw` æ–‡ä»¶ | å•ä¸ªæ–‡ä»¶å½¢å¼çš„æ’ä»¶ï¼Œç›´æ¥æ”¾åœ¨ `plugins` ç›®å½•ä¸‹ |
| æ–‡ä»¶å¤¹ | å¤šæ–‡ä»¶ç»„åˆçš„æ’ä»¶ï¼Œæ–‡ä»¶å¤¹ä¸­å¿…é¡»åŒ…å«å…¥å£æ–‡ä»¶ `setup.py` |

::: info æ–‡ä»¶å¤¹æ’ä»¶è§„åˆ™
- æ–‡ä»¶å¤¹ç›´æ¥æ”¾åœ¨ `plugins` ç›®å½•ä¸‹
- æ–‡ä»¶å¤¹ä¸­å¿…é¡»åŒ…å« `setup.py` ä½œä¸ºå…¥å£æ–‡ä»¶
- æ–‡ä»¶å¤¹å†…éƒ¨çš„å­æ–‡ä»¶å¤¹**ä¸ä¼š**è¢«è¯†åˆ«ä¸ºæ’ä»¶
- `setup.py` ä¸å•ä¸ªæ–‡ä»¶å½¢å¼çš„æ’ä»¶å…·æœ‰ç›¸åŒçš„ç¼–å†™è§„èŒƒ
:::

### æ’ä»¶çš„å¯ç”¨ä¸ç¦ç”¨

æ— è®ºä»»ä½•å½¢å¼çš„æ’ä»¶ï¼Œå½“å…¶æ–‡ä»¶åä»¥ **`d_`** å¼€å¤´æ—¶ï¼ˆå¦‚ `d_something.py`ï¼‰ï¼Œå°†ä¼šè¢«å¿½ç•¥åŠ è½½ï¼Œå³ä¸º **å·²ç¦ç”¨æ’ä»¶**ã€‚

ä½ å¯ä»¥åœ¨ç¾¤é‡Œæ–¹ä¾¿åœ°ç®¡ç†æ’ä»¶ï¼š

| æŒ‡ä»¤ | åŠŸèƒ½ |
| --- | --- |
| `å¯ç”¨æ’ä»¶` | ä½¿ç®€å„¿åŠ è½½æŸä¸ªæ’ä»¶ |
| `ç¦ç”¨æ’ä»¶` | ä½¿ç®€å„¿å¿½ç•¥åŠ è½½æŸä¸ªæ’ä»¶ |
| `é‡è½½æ’ä»¶` | é‡æ–°ä»ç£ç›˜åŠ è½½å…¨éƒ¨æ’ä»¶ï¼ˆæ— éœ€é‡å¯ï¼‰ |
| `æ’ä»¶è§†è§’` | æŸ¥çœ‹æ’ä»¶è¿è¡ŒæŠ¥å‘Šã€å¯ç”¨çŠ¶æ€å’ŒåŠ è½½å¤±è´¥åŸå›  |

## 1. å¼€å§‹åˆ¶ä½œ {#getting-started}

### åˆ›å»ºå•ä¸ªæ–‡ä»¶å½¢å¼çš„æ’ä»¶

åœ¨ `plugins` æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º `.py` æ–‡ä»¶ï¼Œæ–‡ä»¶åä¼šä½œä¸ºæ’ä»¶åç§°ã€‚å¦‚ `Hello World.py`

### åˆ›å»ºæ–‡ä»¶å¤¹å½¢å¼çš„æ’ä»¶

åœ¨ `plugins` æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹åç§°ä¼šä½œä¸ºæ’ä»¶åç§°ã€‚å¦‚ `Hello World`

åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º `setup.py` æ–‡ä»¶ä½œä¸ºå…¥å£æ–‡ä»¶ã€‚å¦‚æœç¼ºå°‘è¯¥æ–‡ä»¶ï¼Œæ’ä»¶å°†æ— æ³•è¢«æ­£å¸¸åŠ è½½ã€‚

`setup.py` å’Œå•ä¸ªæ–‡ä»¶å½¢å¼çš„æ’ä»¶æ“ä½œæ–¹æ³•**å®Œå…¨ç›¸åŒ**ã€‚

### æ³¨å†Œæ’ä»¶

è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼šä¸€ä¸ª `Hello World.py` æ’ä»¶å…·æœ‰ä»¥ä¸‹ä»£ç ï¼š

```python
TRIGGHT_KEYWORD = "ä½ å¥½ï¼Œä¸–ç•Œ"
HELP_MESSAGE = "-ä½ å¥½ï¼Œä¸–ç•Œ â€”> ä»…ä»…å°±æ˜¯ä¸€å¥ Hello world ğŸ¤”ï¼Ÿ"

async def on_message(event, actions, Manager, Segments):
    await actions.send(
        group_id=event.group_id, 
        message=Manager.Message(Segments.Text("Hello, world! ğŸŒ"))
    )
    return True
```

::: tip ğŸ‰ ä»…éœ€ 5 è¡Œä»£ç ï¼
ä»…éœ€ 5 è¡Œä»£ç å³å¯å®Œæˆå¼€å‘ä¸€ä¸ªå¯ä»¥å‘é€æ¶ˆæ¯çš„æ’ä»¶ï¼Œå¯è§ç®€å„¿æ’ä»¶å¼€å‘çš„é«˜æ•ˆæ€§ã€‚
:::

**ä»£ç è¯¦è§£ï¼š**

#### `TRIGGHT_KEYWORD`

`str` ç±»å‹ã€‚æ’ä»¶çš„**è§¦å‘å…³é”®è¯**ï¼Œå³å½“ç”¨æˆ·åœ¨ç¾¤é‡Œå‘é€çš„æ¶ˆæ¯åŒ…å«æ­¤å…³é”®è¯æ—¶ï¼Œè§¦å‘æ­¤æ’ä»¶ã€‚

åœ¨ç¤ºä¾‹ä¸­ï¼Œå½“ç”¨æˆ·å‘é€åŒ…å«"ä½ å¥½ï¼Œä¸–ç•Œ"çš„æ¶ˆæ¯æ—¶ï¼Œæ­¤æ’ä»¶å°†ä¼šè¢«è§¦å‘ã€‚

#### `HELP_MESSAGE`

`str` ç±»å‹ã€‚æ’ä»¶çš„**å¸®åŠ©æ¶ˆæ¯**ã€‚å½“ç”¨æˆ·åœ¨ç¾¤é‡Œ @ç®€å„¿ æˆ–è€…å‘é€"å¸®åŠ©"æ—¶ï¼Œå±•ç¤ºçš„å¸®åŠ©æ–‡ä»¶ä¸­ä¼šåŒ…æ‹¬æ­¤å¸®åŠ©æ¶ˆæ¯æ–‡æœ¬ã€‚

#### `async def on_message()`

æ’ä»¶çš„**å…¥å£å‡½æ•°**ï¼Œå½“æ’ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰§è¡Œ `on_message()` å‡½æ•°å†…éƒ¨çš„ä»£ç ã€‚

::: danger é‡è¦
æ­¤æ–¹æ³•**å¿…é¡»å¼‚æ­¥**ï¼ˆä½¿ç”¨ `async def`ï¼‰ã€‚
:::

#### `return True`

é˜»æ–­æ‰§è¡Œåç»­åŠŸèƒ½ï¼ˆæ­¤è¡Œ**å¯é€‰**ï¼‰ã€‚å½“æ’ä»¶è¿”å› `True` æ—¶ï¼Œç®€å„¿å°†åœæ­¢æ‰§è¡Œåç»­çš„åŠŸèƒ½ï¼Œé˜²æ­¢å¤šä¸ªå…·æœ‰ç›¸åŒè§¦å‘å…³é”®è¯çš„åŠŸèƒ½ä¸€èµ·è¢«æ‰§è¡Œã€‚

### å‚æ•°ä¼ å…¥

`async def on_message()` å‡½æ•°å¯ä»¥æ¥å—å¾ˆå¤šå‚æ•°ï¼Œå„ç§å„æ ·çš„å‚æ•°è¯´æ˜è¯¦è§ [API å‚è€ƒ](/api-reference)ã€‚

ç›´æ¥å°†æƒ³è¦è¢«ä¼ å…¥çš„å‚æ•°å¡«å†™åœ¨å‡½æ•°çš„æ‹¬å·å†…å³å¯ï¼š

```python
async def on_message(event, actions, Manager, Segments)
```

### å®ç°åŠŸèƒ½

`actions`ï¼šè¡ŒåŠ¨å¯¹è±¡ï¼Œç”¨äºæ“ä½œæœºå™¨äººæ‰§è¡Œä¸€ç³»åˆ—æ“ä½œã€‚

`event`ï¼šå½“å‰å·²è¢«è§¦å‘çš„æ¶ˆæ¯äº‹ä»¶ç±»å‹åŠäº‹ä»¶å†…å®¹ã€‚

**ä¸¾ä¾‹ï¼šå‘é€æ¶ˆæ¯**

```python
await actions.send(
    group_id=event.group_id, 
    message=Manager.Message(Segments.Text("Hello, world! ğŸŒ"))
)
```

| ä»£ç  | è¯´æ˜ |
| --- | --- |
| `actions.send()` | å‘é€ä¸€æ¡æ¶ˆæ¯ |
| `event.group_id` | è·å–å½“å‰ç¾¤çš„ç¾¤å·ç  |
| `Manager.Message` | æ„é€ ä¸€æ¡æ¶ˆæ¯ |
| `Segments.Text` | æ„é€ ä¸€æ®µçº¯æ–‡æœ¬æ¶ˆæ¯ |

`actions` å’Œ `event` è¿˜å¯ä»¥å®ç°è®¸å¤šåŠŸèƒ½ï¼Œå®ƒä»¬ç»§æ‰¿äº **OneBot v11** æ¡†æ¶ï¼š

- ğŸ“– [actions API æ–‡æ¡£](https://github.com/botuniverse/onebot-11/blob/master/api/public.md)
- ğŸ“– [event äº‹ä»¶æ–‡æ¡£](https://github.com/botuniverse/onebot-11/blob/master/event/README.md)

æ­å–œä½ ï¼Œä½ å·²ç»å®ç°äº†è‡ªå·±çš„ç¬¬ä¸€ä¸ªæ’ä»¶ï¼å¿«å»è¯•è¯•å§ï½ ğŸ‰

## 2. åˆ¶ä½œè¿›é˜¶ {#advanced}

### è¯»å–é…ç½®æ–‡ä»¶

æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ èƒ½å¤Ÿåœ¨ç®€å„¿çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°é…ç½®æ–‡ä»¶ `config.json`ï¼ŒåŒ…å«äº†æœºå™¨äººçš„åç§°ã€è§¦å‘å…³é”®è¯ç­‰ä¿¡æ¯ã€‚

å¦‚æœè¦åœ¨æ’ä»¶ä¸­åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°æ¥è‡ª **HypeR æ¡†æ¶** ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼š

```python
from Hyper import Configurator

Configurator.cm = Configurator.ConfigManager(
    Configurator.Config(file="config.json").load_from_file()
)
```

æ¥ä¸‹æ¥ï¼Œä»…éœ€ 1 è¡Œä»£ç è·å–é…ç½®æ–‡ä»¶ä¸­çš„å€¼ï¼š

```python
bot_name = Configurator.cm.get_cfg().others["bot_name"]  # è·å–æœºå™¨äººåç§°
```

ä½ å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥é…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚`config.json` ä½¿ç”¨æ ‡å‡†çš„ JSON å­—å…¸æ ¼å¼ï¼Œä½ å¯ä»¥ç›´æ¥æŸ¥çœ‹é…ç½®æ–‡ä»¶ä»¥äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

### æ°¸ä¹…è§¦å‘æ’ä»¶

**æ°¸ä¹…è§¦å‘æ’ä»¶** æ˜¯æŒ‡è¿™ä¸ªæ’ä»¶å°†ä¼šæ¥æ”¶è¿™ä¸ª QQ è´¦å·çš„æ‰€æœ‰äº‹ä»¶ï¼Œæ¯”å¦‚ï¼š

- ç¾¤èŠäº‹ä»¶ï¼ˆ`GroupMessageEvent`ï¼‰
- ç§èŠäº‹ä»¶ï¼ˆ`PrivateMessageEvent`ï¼‰
- åŠ ç¾¤äº‹ä»¶ï¼ˆ`GroupMemberIncreaseEvent`ï¼‰
- é€€ç¾¤äº‹ä»¶ï¼ˆ`GroupMemberDecreaseEvent`ï¼‰
- â€¦â€¦

åªè¦ QQ è´¦å·çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ’ä»¶å°±ä¼šè¢«ç«‹åˆ»è§¦å‘ã€‚

è¦æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶ç±»å‹ï¼Œè¯¦è§ [API å‚è€ƒ - Events](/api-reference#events-äº‹ä»¶ç±»å‹æ¨¡å—)

å¦‚æœä½ æƒ³è¦åšä¸€ä¸ª **æ°¸ä¹…è§¦å‘æ’ä»¶**ï¼Œä»…éœ€å°† `TRIGGHT_KEYWORD` æ”¹åŠ¨ä¸€ä¸ªå€¼ï¼š

```python
TRIGGHT_KEYWORD = "Any"
```

å°† `TRIGGHT_KEYWORD` è®¾ç½®ä¸º `Any`ï¼Œæ— è®ºå‘ç”Ÿä»€ä¹ˆäº‹ä»¶æ’ä»¶éƒ½ä¼šè¢«ç«‹åˆ»æ‰§è¡Œã€‚**è¿™å°±è¦æ±‚æ’ä»¶è‡ªå·±å»åˆ¤æ–­äº‹ä»¶çš„ç±»å‹ä»¥åŠç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶ä½œå‡ºåˆ¤å®š**ã€‚

::: details ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼šé€šè¿‡ç§èŠè§¦å‘çš„ Hello World

```python
from Hyper import Configurator

Configurator.cm = Configurator.ConfigManager(
    Configurator.Config(file="config.json").load_from_file()
)  # åŠ è½½é…ç½®æ–‡ä»¶

TRIGGHT_KEYWORD = "Any"
EXPECTED_VALUE = f"{Configurator.cm.get_cfg().others['reminder']}ä½ å¥½ï¼Œä¸–ç•Œ"
HELP_MESSAGE = f"{EXPECTED_VALUE} â€”> ä»…ä»…å°±æ˜¯ä¸€å¥ Hello world ğŸ¤”ï¼Ÿ"

async def on_message(event, actions, Events, Manager, Segments):
    if isinstance(event, Events.PrivateMessageEvent):  # åˆ¤æ–­æ˜¯å¦ä¸ºç§èŠäº‹ä»¶
        if str(event.message) == EXPECTED_VALUE:  # åˆ¤æ–­æ¶ˆæ¯å†…å®¹
            await actions.send(
                group_id=event.group_id, 
                message=Manager.Message(Segments.Text("Hello, world! ğŸŒ"))
            )
            return True  # æ­¤è¡Œå¯é€‰
```

:::

::: warning æ³¨æ„
`return True` å°†ä¼šé˜»æ–­æ‰§è¡Œ**å…¶ä»–æ‰€æœ‰åŠŸèƒ½**ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚
:::

## 3. æ’ä»¶å¸‚åœº {#plugin-market}

ç®€å„¿ NEXT 3 æ”¯æŒä»æ’ä»¶å¸‚åœºè·å–ç¤¾åŒºåˆ¶ä½œçš„æ’ä»¶ã€‚

ğŸ”— [Jianer æ’ä»¶ç´¢å¼•](https://github.com/IntelliMarkets/Jianer_Plugins_Index)

æ¬¢è¿ç¤¾åŒºå¼€å‘è€…æäº¤ä½ çš„æ’ä»¶ï¼